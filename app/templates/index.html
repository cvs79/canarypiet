<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Canary Piet - Environment Info</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        border: "hsl(var(--border))",
                        input: "hsl(var(--input))",
                        ring: "hsl(var(--ring))",
                        background: "hsl(var(--background))",
                        foreground: "hsl(var(--foreground))",
                        primary: {
                            DEFAULT: "hsl(var(--primary))",
                            foreground: "hsl(var(--primary-foreground))"
                        },
                        secondary: {
                            DEFAULT: "hsl(var(--secondary))",
                            foreground: "hsl(var(--secondary-foreground))"
                        },
                        destructive: {
                            DEFAULT: "hsl(var(--destructive))",
                            foreground: "hsl(var(--destructive-foreground))"
                        },
                        muted: {
                            DEFAULT: "hsl(var(--muted))",
                            foreground: "hsl(var(--muted-foreground))"
                        },
                        accent: {
                            DEFAULT: "hsl(var(--accent))",
                            foreground: "hsl(var(--accent-foreground))"
                        },
                        popover: {
                            DEFAULT: "hsl(var(--popover))",
                            foreground: "hsl(var(--popover-foreground))"
                        },
                        card: {
                            DEFAULT: "hsl(var(--card))",
                            foreground: "hsl(var(--card-foreground))"
                        },
                    },
                    borderRadius: {
                        lg: "var(--radius)",
                        md: "calc(var(--radius) - 2px)",
                        sm: "calc(var(--radius) - 4px)"
                    },
                    keyframes: {
                        "pulse-dot": {
                            "0%, 100%": { opacity: "1" },
                            "50%": { opacity: ".5" }
                        }
                    },
                    animation: {
                        "pulse-dot": "pulse-dot 2s cubic-bezier(0.4, 0, 0.6, 1) infinite"
                    }
                }
            }
        }
    </script>
    <style>
        @layer base {
            :root {
                --background: 0 0% 100%;
                --foreground: 222.2 84% 4.9%;
                --card: 0 0% 100%;
                --card-foreground: 222.2 84% 4.9%;
                --popover: 0 0% 100%;
                --popover-foreground: 222.2 84% 4.9%;
                --primary: 221.2 83.2% 53.3%;
                --primary-foreground: 210 40% 98%;
                --secondary: 210 40% 96.1%;
                --secondary-foreground: 222.2 47.4% 11.2%;
                --muted: 210 40% 96.1%;
                --muted-foreground: 215.4 16.3% 46.9%;
                --accent: 210 40% 96.1%;
                --accent-foreground: 222.2 47.4% 11.2%;
                --destructive: 0 84.2% 60.2%;
                --destructive-foreground: 210 40% 98%;
                --border: 214.3 31.8% 91.4%;
                --input: 214.3 31.8% 91.4%;
                --ring: 221.2 83.2% 53.3%;
                --radius: 0.5rem;
            }

            .dark {
                --background: 222.2 84% 4.9%;
                --foreground: 210 40% 98%;
                --card: 222.2 84% 4.9%;
                --card-foreground: 210 40% 98%;
                --popover: 222.2 84% 4.9%;
                --popover-foreground: 210 40% 98%;
                --primary: 217.2 91.2% 59.8%;
                --primary-foreground: 222.2 47.4% 11.2%;
                --secondary: 217.2 32.6% 17.5%;
                --secondary-foreground: 210 40% 98%;
                --muted: 217.2 32.6% 17.5%;
                --muted-foreground: 215 20.2% 65.1%;
                --accent: 217.2 32.6% 17.5%;
                --accent-foreground: 210 40% 98%;
                --destructive: 0 62.8% 30.6%;
                --destructive-foreground: 210 40% 98%;
                --border: 217.2 32.6% 17.5%;
                --input: 217.2 32.6% 17.5%;
                --ring: 224.3 76.3% 48%;
            }
        }

        * {
            border-color: hsl(var(--border));
        }

        body {
            background-color: hsl(var(--background));
            color: hsl(var(--foreground));
        }
    </style>
</head>

<body class="min-h-screen">
    <div class="container mx-auto p-4 md:p-8 max-w-7xl">
        <!-- Header -->
        <div class="mb-8">
            <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-4">
                <div>
                    <h1 class="scroll-m-20 text-4xl font-extrabold tracking-tight lg:text-5xl mb-2">
                        Canary Piet
                    </h1>
                    <p class="text-muted-foreground text-sm">
                        Environment Information Dashboard
                    </p>
                </div>
                <div class="flex gap-2">
                    <!-- Dark Mode Toggle Button -->
                    <button onclick="toggleDarkMode()"
                        class="inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 w-10"
                        aria-label="Toggle dark mode">
                        <span id="theme-icon" class="text-lg">üåô</span>
                    </button>
                    <!-- Refresh Button -->
                    <button onclick="refreshData()"
                        class="inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2">
                        Refresh
                    </button>
                </div>
            </div>
            <div class="flex flex-wrap items-center gap-4">
                <div class="flex items-center gap-2">
                    <span class="relative flex h-2 w-2">
                        <span
                            class="animate-ping absolute inline-flex h-full w-full rounded-full bg-primary opacity-75"></span>
                        <span class="relative inline-flex rounded-full h-2 w-2 bg-primary"></span>
                    </span>
                    <span class="text-sm font-medium">System Healthy</span>
                </div>
                <span class="text-xs text-muted-foreground" id="last-updated">Loading...</span>
            </div>
        </div>

        <!-- Dashboard Grid -->
        <div id="dashboard" class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Loading State -->
            <div class="rounded-lg border bg-card text-card-foreground shadow-sm p-6">
                <h2 class="text-xl font-semibold tracking-tight mb-2">Loading...</h2>
                <p class="text-sm text-muted-foreground">Fetching environment data...</p>
            </div>
        </div>
    </div>

    <script>
        let autoRefreshInterval;
        const refreshIntervalSeconds = {{ refresh_interval }};

        // Dark mode toggle
        function toggleDarkMode() {
            const html = document.documentElement;
            const isDark = html.classList.contains('dark');
            html.classList.toggle('dark');
            document.getElementById('theme-icon').textContent = isDark ? 'üåô' : '‚òÄÔ∏è';
            localStorage.setItem('theme', isDark ? 'light' : 'dark');
        }

        // Initialize theme
        function initTheme() {
            const savedTheme = localStorage.getItem('theme');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;

            if (savedTheme === 'dark' || (!savedTheme && prefersDark)) {
                document.documentElement.classList.add('dark');
                document.getElementById('theme-icon').textContent = '‚òÄÔ∏è';
            }
        }

        // Fetch and display data
        async function refreshData() {
            try {
                const response = await fetch('/api/info');
                const data = await response.json();
                renderDashboard(data);
                updateLastRefreshed();
            } catch (error) {
                console.error('Error fetching data:', error);
                document.getElementById('dashboard').innerHTML = `
                    <div class="rounded-lg border bg-card text-card-foreground shadow-sm p-6 lg:col-span-2">
                        <div class="flex items-center gap-2 mb-2">
                            <span class="inline-flex h-2 w-2 rounded-full bg-destructive"></span>
                            <h2 class="text-xl font-semibold tracking-tight text-destructive">Error</h2>
                        </div>
                        <p class="text-sm text-muted-foreground">Failed to fetch environment data: ${error.message}</p>
                    </div>
                `;
            }
        }

        function updateLastRefreshed() {
            const now = new Date();
            document.getElementById('last-updated').textContent =
                `Last updated: ${now.toLocaleTimeString()}`;
        }

        function renderDashboard(data) {
            const dashboard = document.getElementById('dashboard');

            let html = '';

            // Container/Host Information
            html += `
                <div class="rounded-lg border bg-card text-card-foreground shadow-sm">
                    <div class="p-6">
                        <h2 class="text-xl font-semibold tracking-tight mb-4">Container Information</h2>
                        <div class="space-y-3">
                            <div class="flex items-center justify-between py-2 border-b last:border-0">
                                <span class="text-sm font-medium text-muted-foreground">Hostname</span>
                                <span class="inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 border-transparent bg-primary text-primary-foreground hover:bg-primary/80">
                                    ${data.hostname}
                                </span>
                            </div>
                            <div class="flex items-center justify-between py-2 border-b last:border-0">
                                <span class="text-sm font-medium text-muted-foreground">Timestamp</span>
                                <span class="text-sm">${data.timestamp}</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            // Platform Information
            if (data.platform) {
                html += `
                    <div class="rounded-lg border bg-card text-card-foreground shadow-sm">
                        <div class="p-6">
                            <h2 class="text-xl font-semibold tracking-tight mb-4">Platform</h2>
                            <div class="space-y-3">
                                ${Object.entries(data.platform).map(([key, value]) => `
                                    <div class="flex items-center justify-between py-2 border-b last:border-0">
                                        <span class="text-sm font-medium text-muted-foreground">${key}</span>
                                        <span class="text-sm">${value}</span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                `;
            }

            // System Resources
            if (data.resources) {
                html += `
                    <div class="rounded-lg border bg-card text-card-foreground shadow-sm">
                        <div class="p-6">
                            <h2 class="text-xl font-semibold tracking-tight mb-4">System Resources</h2>
                            <div class="space-y-3">
                                ${Object.entries(data.resources).map(([key, value]) => `
                                    <div class="flex items-center justify-between py-2 border-b last:border-0">
                                        <span class="text-sm font-medium text-muted-foreground">${key}</span>
                                        <span class="text-sm font-semibold">${value}</span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                `;
            }

            // Network Information
            if (data.network) {
                html += `
                    <div class="rounded-lg border bg-card text-card-foreground shadow-sm">
                        <div class="p-6">
                            <h2 class="text-xl font-semibold tracking-tight mb-4">Network</h2>
                            <div class="space-y-3">
                                ${Object.entries(data.network).map(([key, value]) => `
                                    <div class="flex items-center justify-between py-2 border-b last:border-0">
                                        <span class="text-sm font-medium text-muted-foreground">${key}</span>
                                        <span class="text-sm break-all">${value}</span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                `;
            }

            // Kubernetes Information
            if (data.kubernetes && Object.keys(data.kubernetes).length > 0) {
                html += `
                    <div class="rounded-lg border bg-card text-card-foreground shadow-sm lg:col-span-2">
                        <div class="p-6">
                            <h2 class="text-xl font-semibold tracking-tight mb-4">
                                Kubernetes / Container Orchestration
                            </h2>
                            <div class="space-y-3">
                                ${Object.entries(data.kubernetes).map(([key, value]) => `
                                    <div class="flex items-center justify-between py-2 border-b last:border-0">
                                        <span class="text-sm font-medium text-muted-foreground">${key}</span>
                                        <span class="inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 text-foreground">
                                            ${value}
                                        </span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                `;
            }

            // Request Information
            if (data.request) {
                const headers = data.request.Headers;
                delete data.request.Headers;

                html += `
                    <div class="rounded-lg border bg-card text-card-foreground shadow-sm lg:col-span-2">
                        <div class="p-6">
                            <h2 class="text-xl font-semibold tracking-tight mb-4">Request Information</h2>
                            <div class="space-y-3 mb-6">
                                ${Object.entries(data.request).map(([key, value]) => `
                                    <div class="flex items-center justify-between py-2 border-b last:border-0">
                                        <span class="text-sm font-medium text-muted-foreground">${key}</span>
                                        <span class="text-sm break-all">${value}</span>
                                    </div>
                                `).join('')}
                            </div>
                            <div class="mt-6">
                                <h3 class="text-lg font-semibold tracking-tight mb-3">Request Headers</h3>
                                 <div class="rounded-md border bg-muted p-4">
                                    <pre class="text-xs font-mono overflow-x-auto text-foreground">${JSON.stringify(headers, null, 2)}</pre>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            // Environment Variables
            if (data.environment) {
                const sortedEnv = Object.entries(data.environment).sort((a, b) =>
                    a[0].localeCompare(b[0])
                );

                html += `
                    <div class="rounded-lg border bg-card text-card-foreground shadow-sm lg:col-span-2">
                        <div class="p-6">
                            <div class="flex items-center gap-2 mb-4">
                                <h2 class="text-xl font-semibold tracking-tight">Environment Variables</h2>
                                <span class="inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 text-foreground">
                                    ${sortedEnv.length} total
                                </span>
                            </div>
                             <div class="rounded-md border bg-muted p-4 max-h-96 overflow-y-auto">
                                <pre class="text-xs font-mono text-foreground">${sortedEnv.map(([key, value]) =>
                    `${key}=${value}`
                ).join('\n')}</pre>
                            </div>
                        </div>
                    </div>
                `;
            }

            dashboard.innerHTML = html;
        }

        // Start auto-refresh
        function startAutoRefresh() {
            if (refreshIntervalSeconds > 0) {
                autoRefreshInterval = setInterval(refreshData, refreshIntervalSeconds * 1000);
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            initTheme();
            refreshData();
            startAutoRefresh();
        });
    </script>
</body>

</html>